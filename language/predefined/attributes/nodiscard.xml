<?xml version="1.0" encoding="utf-8"?>
<!-- EN-Revision: 02bee41067ab2822cbffcb4b3b2387f79488dffd Maintainer: lacatoire Status: ready -->
<reference xml:id="class.nodiscard" role="class" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude">
 <title>L'attribut NoDiscard</title>
 <titleabbrev>NoDiscard</titleabbrev>

 <partintro>

  <section xml:id="nodiscard.intro">
   &reftitle.intro;
   <simpara>
    Cet attribut peut être utilisé pour indiquer que la valeur de retour d'une
    fonction ou d'une méthode ne doit pas être ignorée. Si la valeur de retour
    n'est utilisée d'aucune manière, un avertissement sera émis.
   </simpara>
   <simpara>
    Cela est utile pour les fonctions où ne pas vérifier la valeur de retour
    est probablement un bogue.
   </simpara>
   <simpara>
    Pour ignorer intentionnellement la valeur de retour d'une telle fonction,
    il est possible d'utiliser le cast (void) pour supprimer l'avertissement.
   </simpara>
   <note>
    <simpara>
     Étant donné que les attributs sont conçus pour être rétrocompatibles,
     <code>#[\NoDiscard]</code> peut être ajouté aux fonctions et méthodes
     même lorsque PHP 8.4 ou inférieur est supporté, il ne fera simplement rien.
     Sur PHP 8.5 et supérieur, un avertissement sera émis si le résultat n'est pas utilisé.
     Pour supprimer l'avertissement sans utiliser <code>(void)</code>,
     qui n'est pas supporté avant PHP 8.5,
     il est possible d'utiliser une variable comme <code>$_</code>.
    </simpara>
   </note>
  </section>

  <section xml:id="nodiscard.synopsis">
   &reftitle.classsynopsis;

   <classsynopsis class="class">
    <ooclass>
     <modifier>final</modifier>
     <classname>NoDiscard</classname>
    </ooclass>

    <classsynopsisinfo role="comment">&Properties;</classsynopsisinfo>
    <fieldsynopsis>
     <modifier>public</modifier>
     <modifier>readonly</modifier>
     <type class="union"><type>string</type><type>null</type></type>
     <varname linkend="nodiscard.props.message">message</varname>
    </fieldsynopsis>

    <classsynopsisinfo role="comment">&Methods;</classsynopsisinfo>
    <xi:include xpointer="xmlns(db=http://docbook.org/ns/docbook) xpointer(id('class.nodiscard')/db:refentry/db:refsect1[@role='description']/descendant::db:constructorsynopsis[@role='NoDiscard'])">
     <xi:fallback/>
    </xi:include>
   </classsynopsis>

  </section>

  <section xml:id="nodiscard.props">
   &reftitle.properties;
   <variablelist>
    <varlistentry xml:id="nodiscard.props.message">
     <term><varname>message</varname></term>
     <listitem>
      <simpara>
       Un message optionnel expliquant pourquoi la valeur de retour ne doit pas être ignorée.
      </simpara>
     </listitem>
    </varlistentry>
   </variablelist>
  </section>

  <section>
   &reftitle.examples;
   <example>
    <title>Utilisation basique</title>
    <programlisting role="php">
<![CDATA[
<?php

/**
 * Processes all the given items and returns an array with the results of the
 * operation for each item. `null` indicates success and an Exception indicates
 * an error. The keys of the result array match the keys of the $items array.
 *
 * @param array<string> $items
 * @return array<null|Exception>
 */
#[\NoDiscard("as processing might fail for individual items")]
function bulk_process(array $items): array {
	$results = [];

	foreach ($items as $key => $item) {
		if (\random_int(0, 9999) < 9999) {
			// On prétend faire quelque chose d'utile avec $item,
			// ce qui réussira dans 99,99% des cas.
			echo "Processing {$item}", PHP_EOL;
			$error = null;
		} else {
			$error = new \Exception("Failed to process {$item}.");
		}

		$results[$key] = $error;
	}

	return $results;
}

bulk_process($items);

?>
]]>
    </programlisting>
    &example.outputs.85.similar;
    <screen>
<![CDATA[
Warning: The return value of function bulk_process() should either be used or intentionally ignored by casting it as (void), as processing might fail for individual items
]]>
    </screen>
   </example>
   <example>
    <title>Ignorer intentionnellement la valeur de retour</title>
    <programlisting role="php">
<![CDATA[
<?php

#[\NoDiscard]
function some_command(): int {
    return 1;
}

// Supprimer l'avertissement avec (void) - PHP 8.5+
(void) some_command();

// Pour la compatibilité avec les versions de PHP antérieures à 8.5, utiliser une variable temporaire
$_ = some_command();

?>
]]>
    </programlisting>
   </example>
  </section>

  <section xml:id="nodiscard.seealso">
   &reftitle.seealso;
   <simplelist>
    <member><link linkend="language.attributes">Vue d'ensemble des attributs</link></member>
   </simplelist>
  </section>

 </partintro>

 &language.predefined.attributes.nodiscard.construct;

</reference>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
