<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: 83d670adaa1c2320bedfb0f5c47e0aa703ba5cce Maintainer: yannick Status: ready -->
<!-- Reviewed: no -->

<section xml:id="mongo.updates" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Mises à jour</title>

 <para>
  Les mises à jour sont les opérations les plus compliquées disponibles avec
  MongoDB. Elles combinent une requête avec une action, modifiant
  les documents qui correspondent aux critères. Elles sont également
  extrèmement puissantes, vous permettant de changer les documents
  rapidement mais aussi de les remplacer tous ensemble. Elles se font
  sur place (quand c'est possible), entrainant une légère surcharge. 
 </para>

 <section>
  <title>Mises à jour des objets imbriqués</title>
  <para>
   Supposez que vous voulez modifier le nom de l'auteur d'un commentaire dans
   un document :
   <programlisting>
<![CDATA[
{ 
    "_id" : ObjectId("4b06c282edb87a281e09dad9"), 
    "content" : "ceci est un post d'un blog.",
    "comments" : 
    [
        {
            "author" : "Mike",
            "comment" : "Je pense que blah blah blah...",
        },
        {
            "author" : "John",
            "comment" : "Je ne suis pas d'accord."
        }
    ]
}
]]>
   </programlisting>
   Afin de modifie un champ interne, nous utilisez $set (ainsi, les
   autres champs ne sont pas supprimés) avec l'index du commentaire à
   changer :
   <programlisting role="php">
<![CDATA[
<?php

$blog->update($criteria, array('$set' => array("comments.1" => array("author" => "Jim"))));

?>
]]>
   </programlisting>
  </para>
 </section>

 <section>
  <title>L'opérateur de position</title>
  <para>
   L'opérateur de position <literal>$</literal> est utile pour la mise
   à jour d'objets qui se trouvent dans des tableaux. Dans l'exemple suivant,
   nous supposons que nous ne connaissons pas l'index du commentaire que nous
   souhaitons modifier, alors que vous voulons changer "John" en "Jim".
   Nous pouvons dans ce cas utiliser l'opérateur de position <literal>$</literal>.
  </para>
  <programlisting role="php">
<![CDATA[
<?php

$blog->update(
    array("comments.author" => "John"), 
    array('$set' => array('comments.$.author' => "Jim")));

?>
]]>
  </programlisting>
 </section>
</section>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
