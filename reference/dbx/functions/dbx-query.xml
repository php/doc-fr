<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.6 $ -->
<!-- EN-Revision: 1.1 Maintainer: nobody Status: partial -->

<!-- splitted from ./fr/functions/dbx.xml, last change in rev 1.5 -->
<!-- last change to 'dbx-query' in en/ tree in rev 1.3 -->
  <refentry id="function.dbx-query">
   <refnamediv>
    <refname>dbx_query</refname>
    <refpurpose>Envoie une requête et lit tous les résultats</refpurpose>
   </refnamediv>
   <refsect1>
    <title>Description</title>
     <methodsynopsis>
      <type>object</type><methodname>dbx_query</methodname>
      <methodparam><type>object</type><parameter>link_identifier</parameter></methodparam>
      <methodparam><type>string</type><parameter>sql_statement</parameter></methodparam>
      <methodparam choice="opt"><type>int</type><parameter>flags</parameter></methodparam>
     </methodsynopsis>
    <simpara>
      retourne un objet dbx_result_object ou 
     <literal>1</literal>  en cas de succès (un objet de résultat
     ne sera retourné que pour les requêtes SQL qui retournent un
     résultat), ou 0 en cas d'erreur. 
    </simpara>
    <example>
     <title>Comment gérer la valeur retournée par <function>dbx_query</function></title>
     <programlisting role="php">
<![CDATA[
<?php
$link   = dbx_connect(DBX_ODBC, "", "db", "username", "password")
    or die("Impossible de se connecter");

$result = dbx_query($link, 'SELECT id, parentid, description FROM table');

if ( is_object($result) ) {
    // ... Faire quelquechose d'utile ici
    // first, print out field names and types 
    // then, draw a table filled with the returned field values
}
else if ( $result == 1 ) {
    echo("Requête exécutée correctement, mais pas de résultat.");
}
else {
    exit("La requête a échoué");
}

dbx_close($link);
?>
]]>
     </programlisting>
    </example>

    <para>     
     Le paramètre
     <parameter>flags</parameter> sert à contrôler la quantité
     d'informations retournée. Il peut être n'importe quelle
     combinaisons par l'opérateur OR des constantes ci-après. Les constantes
     remplacent la configuration du &php.ini;.
          <variablelist>
      <varlistentry>
       <term>
        <constant>DBX_RESULT_INDEX</constant>
       </term>
       <listitem>
        <simpara>
         Ce paramètre est <emphasis>toujours</emphasis> activé, 
         c'est à dire que l'objet retourné dispose du membre 
         <property>data</property> qui est un tableau à deux dimensions,
         indexé numériquement. Par exemple, dans l'expression
         <literal>data[2][3]</literal> <literal>2</literal> représente
         le numéro de ligne et <literal>3</literal> représente 
         le numéro de colonne. Les premières lignes et colonnes 
         sont indexées à 0.
        </simpara>
        <simpara>
         Si <constant>DBX_RESULT_ASSOC</constant> est aussi spécifié, l'objet
         retourné contient en plus les informations liées à 
         <constant>DBX_RESULT_INFO</constant>, même si il n'a pas été spécifié.
        </simpara>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>
        <constant>DBX_RESULT_INFO</constant>
       </term>
       <listitem>
        <simpara>
         Cette option fournit des informations sur les colonnes, comme
         les noms des champs et leur type.
        </simpara>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>
        <constant>DBX_RESULT_ASSOC</constant>
       </term>
       <listitem>
        <simpara>
         Cette option fait que la valeur des champs peut être accessible
         avec le nom de la colonne, utilisé comme clé dans le tableau du
         membre <property>data</property>.
        </simpara>
        <simpara>
         Les résultats ainsi associés sont des références sur les valeurs
         identifiées par les index numériques, ce quie fait que modifier
         <literal>data[0][0]</literal> fait que 
         <literal>data[0]['nom_de_la_premiere_colonne']</literal> sera aussi
         modifié.
        </simpara>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>
        <constant>DBX_COLNAMES_UNCHANGED</constant> (disponible depuis PHP 4.3.0)
       </term>
       <listitem>
        <simpara>
         La casse du nom des colonnes retournée ne sera pas modifiée.
        </simpara>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>
        <constant>DBX_COLNAMES_UPPERCASE</constant> (disponible depuis PHP 4.3.0)
       </term>
       <listitem>
        <simpara>
         Les noms de colonnes seront mis en majuscules.
        </simpara>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>
        <constant>DBX_COLNAMES_LOWERCASE</constant> (disponible depuis PHP 4.3.0)
       </term>
       <listitem>
        <simpara>
         Les noms de colonnes seront mis en minuscules.
        </simpara>
       </listitem>
      </varlistentry>
     </variablelist>
     Notez que <constant>DBX_RESULT_INDEX</constant> est toujours active,
     indépendemment de la valeur de <parameter>flags</parameter>. Cela signifie
     que seules les combinaisons suivantes sont utiles : 
     <itemizedlist>
      <listitem>
       <simpara>
        <constant>DBX_RESULT_INDEX</constant>
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <constant>DBX_RESULT_INDEX</constant> |
        <constant>DBX_RESULT_INFO</constant>
       </simpara>
      </listitem>
      <listitem>
       <simpara>
        <constant>DBX_RESULT_INDEX</constant> |
        <constant>DBX_RESULT_INFO</constant> |
        <constant>DBX_RESULT_ASSOC</constant> - c'est la valeur par défaut,
        si <parameter>flags</parameter> est omis.
       </simpara>
      </listitem>
     </itemizedlist>
    </para>
    <para> 
    </para>
    <para>
     Un objet dbx_result_object a 5 membres (éventuellement 4, suivants
     les valeurs de <parameter>flags</parameter>) : 
     <variablelist>
      <varlistentry>
       <term>
        <property>handle</property>
       </term>
       <listitem>
        <para>
         Ceci est une ressource représentant la connexion à la 
         base de données, et il peut être utilisé (si nécessaire) avec
         les fonctions spécialisées de la base.
         <example role="php">
          <title>Exemple avec <function>dbx_query</function></title>
          <programlisting>
<![CDATA[
<?php
  $result = dbx_query($link, "SELECT id FROM table");
  mysql_field_len($result->handle, 0);
?>
]]>
          </programlisting>
         </example>
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>
        <property>cols</property> et <property>rows</property>
       </term>
       <listitem>
        <para>
         Ces deux membres contiennent respectivement le nombre de colonne et de
         ligne.
         <informalexample>
          <programlisting role="php">
<![CDATA[
$result = dbx_query ($link, 'SELECT id FROM table');
echo $result->rows; // nombre de lignes
echo $result->cols; // nombre de champs
]]>
          </programlisting>
         </informalexample>
        </para>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>
        <property>info</property> (optionnel)
       </term>
       <listitem>
        <simpara>
         Ce membre est retourné uniquement si <constant>DBX_RESULT_INFO</constant> ou
         <constant>DBX_RESULT_ASSOC</constant> sont spécifiés dans le paramètre
         <parameter>flags</parameter>. C'est un tableau à deux dimensions,
         avec deux lignes (<literal>name</literal> et
         <literal>type</literal>) pour lire les informations de colonnes.
        </simpara>
        <example>
         <title>Listes les types et noms de colonnes avec dbplus</title>
         <programlisting role="php">
<![CDATA[
$result = dbx_query ($link, 'SELECT id FROM table',
                     DBX_RESULT_INDEX | DBX_RESULT_INFO);

for ($i = 0; $i < $result->cols; $i++ ) {
    echo $result->info['name'][$i] . "\n";
    echo $result->info['type'][$i] . "\n";  
}
]]>
         </programlisting>
        </example>
       </listitem>
      </varlistentry>
      <varlistentry>
       <term>
        <property>data</property>
       </term>
       <listitem>
        <simpara>
         Ce membre contient les résultat obtenus, possiblement associés
         avec le nom de colonne, en fonction de la valeur du paramètre 
         <parameter>flags</parameter>. Si <constant>DBX_RESULT_ASSOC</constant> 
         est activé, il est possible d'utiliser aussi
         <literal>$result->data[2]["nom_de_la_colonne"]</literal>.
        </simpara>
        <example>
         <title>Afficher le contenu d'une base avec dbplus</title>
         <programlisting role="php">
<![CDATA[
$result = dbx_query ($link, 'SELECT id, parentid, description FROM table');

echo "<table>\n";
foreach ( $result->data as $row ) {
    echo "<tr>\n";
    foreach ( $row as $field ) {
        echo "<td>$field</td>";
    }
    echo "</tr>\n";
}
echo "</table>\n";
]]>
         </programlisting>
        </example>
       </listitem>
      </varlistentry>
     </variablelist>
    </para>
    <note>
     <para>
      Reportez-vous aussi à la documentation de la base de données que vous
      utilisez.
     </para>
    </note>
    <para>
     Voir aussi
     <function>dbx_escape_string</function> et
     <function>dbx_connect</function>.
    </para>
   </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
