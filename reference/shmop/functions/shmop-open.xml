<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: 41d34439ea8cae2bb1204264c1bce15d88284503 Maintainer: yannick Status: ready -->
<!-- Reviewed: yes -->
<refentry xmlns="http://docbook.org/ns/docbook" xml:id="function.shmop-open">
 <refnamediv>
  <refname>shmop_open</refname>
  <refpurpose>Crée ou ouvre un bloc de mémoire partagée</refpurpose>
 </refnamediv>
 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <type class="union"><type>Shmop</type><type>false</type></type><methodname>shmop_open</methodname>
   <methodparam><type>int</type><parameter>key</parameter></methodparam>
   <methodparam><type>string</type><parameter>mode</parameter></methodparam>
   <methodparam><type>int</type><parameter>permissions</parameter></methodparam>
   <methodparam><type>int</type><parameter>size</parameter></methodparam>
  </methodsynopsis>
  <simpara>
   <function>shmop_open</function> peut créer ou ouvrir un bloc
   de mémoire partagée.
  </simpara>
 </refsect1>
 <refsect1 role="parameters">
  &reftitle.parameters;
  <para>
   <variablelist>
    <varlistentry>
     <term><parameter>key</parameter></term>
     <listitem>
      <simpara>
       Identifiant système pour le bloc de mémoire partagé.
       Ce paramètre peut être passé comme un décimal ou
       un hexadécimal.
      </simpara>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><parameter>mode</parameter></term>
     <listitem>
      <para>
       Il est possible d'utiliser :
       <itemizedlist>
        <listitem>
         <simpara>
          <literal>"a"</literal> pour accès (utilise <literal>SHM_RDONLY</literal> pour shmat)
          utilisez cette option pour ouvrir un bloc déjà existant en lecture
          seule.
         </simpara>
        </listitem>
        <listitem>
         <simpara>
          <literal>"c"</literal> pour création (utilise <literal>IPC_CREATE</literal>)
          utilisez cette option pour créer un nouveau bloc, ou, si un
          segment avec le même identifiant existe, essayer d'y accéder en
          lecture et écriture.
         </simpara>
        </listitem>
        <listitem>
         <simpara>
          <literal>"w"</literal> pour accès en lecture et écriture. Utilisez
          cette option lorsque l'on doit accéder en lecture et
          écriture à un segment de mémoire partagée.
          C'est le cas le plus courant.
         </simpara>
        </listitem>
        <listitem>
         <simpara>
          <literal>"n"</literal> crée un nouveau segment de mémoire partagée
          (utilise <literal>IPC_CREATE|IPC_EXCL</literal>). Utilisez cette option
          lorsque l'on veut créer un nouveau segment de mémoire
          partagée. Si un segment existe déjà avec la même clé,
          la fonction échouera. Ceci est très pratique pour des raisons
          de sécurité, pour éviter des trous de sécurité
          qui exploiteraient la course aux ressources.
         </simpara>
        </listitem>
       </itemizedlist>
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><parameter>permissions</parameter></term>
     <listitem>
      <simpara>
       Les permissions que l'on donnez à ce bloc. Ce sont
       les mêmes que pour les fichiers. Ces permissions doivent
       être passées sous forme d'octal (i.e. 0644).
      </simpara>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><parameter>size</parameter></term>
     <listitem>
      <simpara>
       La taille du bloc mémoire partagé que l'on veut créer, en octets
      </simpara>
     </listitem>
    </varlistentry>
   </variablelist>
   <note>
    <simpara>
     Note : Les troisième et quatrième paramètres doivent être passés à 0 si l'on
     veut ouvrir un bloc de mémoire partagée déjà existant.
    </simpara>
   </note>
  </para>
 </refsect1>
 <refsect1 role="returnvalues">
  &reftitle.returnvalues;
  <simpara>
   En cas de succès, <function>shmop_open</function> retourne une
   instance de <classname>Shmop</classname> que l'on peut utiliser pour accéder à la mémoire que
   l'on vient de créer. &false; sera retourné en cas d'échec.
  </simpara>
 </refsect1>

 <refsect1 role="errors">
  &reftitle.errors;
  <simpara>
   Si <parameter>mode</parameter> est invalide, ou si <parameter>size</parameter> est inférieur ou égal à zéro,
   une <classname>ValueError</classname> est levée.
   Dans d'autres cas d'échec, un <constant>E_WARNING</constant> est émis.
  </simpara>
 </refsect1>

 <refsect1 role="changelog">
  &reftitle.changelog;
  <informaltable>
   <tgroup cols="2">
    <thead>
     <row>
      <entry>&Version;</entry>
      <entry>&Description;</entry>
     </row>
    </thead>
    <tbody>
     <row>
      <entry>8.0.0</entry>
      <entry>
       En cas de succès, cette fonction retourne désormais une instance de <classname>Shmop</classname> ;
       auparavant, une <type>resource</type> était retournée.
      </entry>
     </row>
     <row>
      <entry>8.0.0</entry>
      <entry>
       Si <parameter>mode</parameter> est invalide, ou si <parameter>size</parameter> est inférieur ou égal à zéro,
       une <classname>ValueError</classname> est levée ; auparavant, un <constant>E_WARNING</constant> était émis à la place,
       et la fonction retournait &false;.
      </entry>
     </row>
    </tbody>
   </tgroup>
  </informaltable>
 </refsect1>

 <refsect1 role="examples">
  &reftitle.examples;
  <example>
   <title>Création d'un nouveau bloc de mémoire partagée Shmop</title>
   <programlisting role="php">
<![CDATA[
<?php
$shm_key = ftok(__FILE__, 't');
$shm_id = shmop_open($shm_key, "c", 0644, 100);
?>
]]>
   </programlisting>
  </example>
  <simpara>
   Cet exemple ouvre un nouveau bloc de mémoire partagée,
   dont l'identifiant est retourné par <function>ftok</function>.
  </simpara>
 </refsect1>
 <refsect1 role="seealso">
  &reftitle.seealso;
  <simplelist>
   <member><function>shmop_close</function></member>
   <member><function>shmop_delete</function></member>
  </simplelist>
 </refsect1>
</refentry>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
