<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.5 $ -->
 <reference id="ref.pgsql">
  <title>PostgreSQL</title>
  <titleabbrev>PostgreSQL</titleabbrev>
  <partintro>
   <section id="pgsql.intro">
    &reftitle.intro;
    <para>
     La base de donn&eacute;es PostgreSQL est un produit Open Source, disponible 
     sans frais. Postgres, d&eacute;velopp&eacute; au d&eacute;partement de
     Science informatique, &agrave; UC Berkeley, mis en place la majorit&eacute;
     des concepts des bases relationnelles, actuellement disponibles sur le
     march&eacute;. PostgreSQL accepte le langage SQL92/SQL3, assure
     l'int&eacute;grit&eacute; transactionnelle, et l'extension de type.
     PostgreSQL est une &eacute;volution du code originale de Berkeley.
    </para>
   </section>

   <section id="pgsql.requirements">
    &reftitle.required;
    <para>
     Pour acc&eacute;der au support PostgreSQL, vous avez besoin de PostgreSQL 6.5
     ou plus r&eacute;cent, PostgreSQL 7.0 ou plus r&eacute;cent pour activer toutes les
     fonctionnalit&eacute;s du moduel PostgreSQL. PostgreSQL supporte de nombreux
     jeux de caract&egrave;res, y compris les jeux multi-octets asiatiques. La 
     version courante et plus de d&eacute;tails sur PostgreSQL sont accessibles
     sur le site <ulink url="&url.pgsql;">&url.pgsql;</ulink> et
     <ulink url="&url.pgsql.techdocs;">&url.pgsql.techdocs;</ulink>.
    </para>
   </section>

   &reference.pgsql.configure;

   &reference.pgsql.ini;

   <section id="pgsql.using">
    <title>Trucs et astuces d'utilisation</title>
    <warning>
     <para>
      Utiliser le module PostgreSQL avec PHP 4.0.6 n'est pas recommand&eacute;
      &agrave; cause d'un bug dans le gestionnaire d'alerte. Utilisez plut&ocirc;t la
      version 4.1.0 ou plus r&eacute;cent.
     </para>
    </warning>
    <warning>
     <para>
      Le nom des fonctions PostgreSQL va changer dans la version 4.2.0 pour
      prendre en compte les standards actuels de programmation. La plupart
      des nouveaux noms recevront des soulign&eacute;s, comme par exemple 
      pg_lo_open(). Certaines fonctions sont renomm&eacute;es diff&eacute;remment, comme
      par exemple pg_exec() en pg_query(). Les anciens noms sont toujours
      utilis&eacute;s pour encore quelques versions, mais ils seront 
      bient&ocirc;t supprim&eacute;s d&eacute;finitivement.
     </para>
    <table>
     <title>Nom des fonctions qui ont chang&eacute;</title>
     <tgroup cols="2">
      <thead>
       <row>
        <entry>Ancien nom</entry>
        <entry>Nouveau nom</entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry><function>pg_cmdtuples</function></entry>
        <entry><function>pg_affected_rows</function></entry>
       </row>
       <row>
        <entry><function>pg_errormessage</function></entry>
        <entry><function>pg_last_error</function></entry>
       </row>
       <row>
        <entry><function>pg_exec</function></entry>
        <entry><function>pg_query</function></entry>
       </row>
       <row>
        <entry><function>pg_fieldname</function></entry>
        <entry><function>pg_field_name</function></entry>
       </row>
       <row>
        <entry><function>pg_fieldsize</function></entry>
        <entry><function>pg_field_size</function></entry>
       </row>
       <row>
        <entry><function>pg_fieldnum</function></entry>
        <entry><function>pg_field_num</function></entry>
       </row>
       <row>
        <entry><function>pg_fieldprtlen</function></entry>
        <entry><function>pg_field_prtlen</function></entry>
       </row>
       <row>
        <entry><function>pg_fieldisnull</function></entry>
        <entry><function>pg_field_is_null</function></entry>
       </row>
       <row>
        <entry><function>pg_freeresult</function></entry>
        <entry><function>pg_free_result</function></entry>
       </row>
       <row>
        <entry><function>pg_getlastoid</function></entry>
        <entry><function>pg_last_oid</function></entry>
       </row>
       <row>
        <entry><function>pg_loreadall</function></entry>
        <entry><function>pg_lo_read_all</function></entry>
       </row>
       <row>
        <entry><function>pg_locreate</function></entry>
        <entry><function>pg_lo_create</function></entry>
       </row>
       <row>
        <entry><function>pg_lounlink</function></entry>
        <entry><function>pg_lo_unlink</function></entry>
       </row>
       <row>
        <entry><function>pg_loopen</function></entry>
        <entry><function>pg_lo_open</function></entry>
       </row>
       <row>
        <entry><function>pg_loclose</function></entry>
        <entry><function>pg_lo_close</function></entry>
       </row>
       <row>
        <entry><function>pg_loread</function></entry>
        <entry><function>pg_lo_read</function></entry>
       </row>
       <row>
        <entry><function>pg_lowrite</function></entry>
        <entry><function>pg_lo_write</function></entry>
       </row>
       <row>
        <entry><function>pg_loimport</function></entry>
        <entry><function>pg_lo_import</function></entry>
       </row>
       <row>
        <entry><function>pg_loexport</function></entry>
        <entry><function>pg_lo_export</function></entry>
       </row>
       <row>
        <entry><function>pg_numrows</function></entry>
        <entry><function>pg_num_rows</function></entry>
       </row>
       <row>
        <entry><function>pg_numfields</function></entry>
        <entry><function>pg_num_fields</function></entry>
       </row>
       <row>
        <entry><function>pg_result</function></entry>
        <entry><function>pg_fetch_result</function></entry>
       </row>
      </tbody>
     </tgroup>
    </table>
    <para>
     Les anciennes syntaxes de <function>pg_connect</function>/<function>pg_pconnect</function>
     seront rendues obsol&egrave;tes pour supporter les nouvelles connexions asynchrones.
     Utilisez la cha&icirc;ne de connexion avec <function>pg_connect</function>
     et <function>pg_pconnect</function>.
    </para>
   </warning>
   <para>
    Toutes les fonctions ne sont pas support&eacute;es par toutes les
    compilations. Cela d&eacute;pend de votre librairie libpq 
    (la librairie C client de PostgreSQL), et comment libq
    est compil&eacute;. Si il y a des fonctions qui manquent, libpq ne 
    supporte par la fonctionnalit&eacute; sur laquelle reposait la fonction
    n'est pas disponible.
   </para>
   <para>
    Il est aussi important que vous utilisiez une version de libpq
    qui soit plus r&eacute;cente que le serveur sur lequel vous vous connectez.
    Si vous utilisez une version de libq plus ancienne que le serveur,
    vous aurez des probl&egrave;mes.
   </para>
   <para>
    Depuis la version 6.3 (03/02/1998) PostgreSQL utilise les sockets UNIX, et
    une table est d&eacute;di&eacute;e &agrave; ces nouvelles capacit&eacute;s.
    La socket est situ&eacute;e dans le dossier
    <filename>/tmp/.s.PGSQL.5432</filename>. Cette option peut &ecirc;tre
    activ&eacute;e avec '-i' pass&eacute; au  <command>postmaster</command>
    et cela s'interpr&egrave;te: "&eacute;coute sur les sockets TCP/IP et sur
    les sockets Unix".
    <table>
     <title>Postmaster et PHP</title>
     <tgroup cols="3">
      <thead>
       <row>
	<entry>Postmaster</entry>
	<entry>PHP</entry>
	<entry>Statut</entry>
       </row>
      </thead>
      <tbody>
       <row>
	<entry>postmaster &amp;</entry>
	<entry>pg_connect("dbname=MonDbName");</entry>
	<entry>OK</entry>
       </row>
       <row>
	<entry>postmaster -i &amp;</entry>
	<entry>pg_connect("dbname=MonDbName");</entry>
	<entry>OK</entry>
       </row>
       <row>
	<entry>postmaster &amp;</entry>
	<entry>pg_connect("host=localhost dbname=MonDbName");</entry>
	<entry>
	 Unable to connect to PostgreSQL server: connectDB() failed:
	 Impossible de se connecter au serveur PostgreSQL:
	 connectDB() a &eacute;chou&eacute;. Est ce que le postmaster fonctionne,
	 et accepte les TCP/IP (option -i) sur le port '5432'?
	</entry>
       </row>
       <row>
	<entry>postmaster -i &amp;</entry>
	<entry>pg_connect("host=localhost dbname=MonDbName");</entry>
	<entry>OK</entry>
       </row>
      </tbody>
     </tgroup>
    </table>
   </para>
   <para>
    Il est possible de se connecter avec la commande suivante :
    <command>$conn = pg_Connect("host=monHote port=monPort tty=monTTY
    options=myOptions dbname=myDB user=myUser password=myPassword");
    </command>
   </para>
   <para>
    L'ancienne syntaxe :
    <command>
      $conn = pg_connect("host", "port", "options", "tty", "dbname")
    </command>
    est obsol&egrave;te.
   </para>
   <para>
    Les variables environnementales affecent le comportement de PostgreSQL.
    Par exemple, le module PostgreSQL va rechercher PGHOST
    dans les variables d'environnement, si le nom du serveur h&ocirc;te est
    omis dans la cha&icirc;ne de connexion. Les variables d'environnement
    support&eacute;es sont diff&eacute;rentes suivant les versions. Reportez vous au
    manuel du programmeur PostgreSQL (libpq - Environment Variables) pour plus 
    de d&eacute;tails.
   </para>
   <para>
    Assurez vous que vous avez bien configur&eacute; vos variables d'environnement pour
    le bon utilisateur. Utilisez <literal>$_ENV</literal> ou 
    <function>getenv</function> pour v&eacute;rifier quelles variables d'environnement
    sont disponibles pour le processus courant.
   </para>
   <example>
    <title>Configuration par d&eacute;faut des param&egrave;tres</title>
    <programlisting>
<![CDATA[
PGHOST=pgsql.example.com
PGPORT=7890
PGDATABASE=web-system
PGUSER=web-user
PGPASSWORD=secret
PGDATESTYLE=ISO
PGTZ=JST
PGCLIENTENCODING=EUC-JP

export PGHOST PGPORT PGDATABASE PGUSER PGPASSWORD PGDATESTYLE PGTZ PGCLIENTENCODING
]]>
     </programlisting>
    </example>
   </section>

   &reference.pgsql.constants;
   
   <section id="pgsql.examples">
    &reftitle.examples;
    <para>
     Depuis PostgreSQL 7.1.0, vous pouvez stocker jusqu'&agrave; 1Go dans
     un champ de type text. Dans les anciennes versions, vous &eacute;tiez
     limit&eacute; &agrave; la taille maximale d'un bloc (qui, par d&eacute;faut, valait
     8 ko, et au mieux, 32 ko, suivant le choix au moment de la compilation).
    </para>
    <para>
     Pour utiliser l'interface des grands objets (large object (lo) interface),
     il est n&eacute;cessaire de les placer dans un bloc de transaction. Un bloc
     de transaction commence avec <command>begin</command> et si la transaction
     se termine avec un <command>commit</command> et <command>end</command>. Si
     la transaction &eacute;choue, elle doit &ecirc;tre conclue par un
     <command>abort</command> et <command>rollback</command>.
     <example>
      <title>Utilisation des objets de grande taille (Large Objects)</title>
      <programlisting role="php">
<![CDATA[
<?php
    $database = pg_connect ("dbname=jacarta");
    pg_query ($database, "begin");
    $oid = pg_lo_create ($database);
    echo "$oid\n";
    $handle = pg_lo_open ($database, $oid, "w");
    echo "$handle\n";
    pg_lo_write ($handle, "large object data");
    pg_lo_close ($handle);
    pg_query ($database, "commit");
?>
]]>
      </programlisting>
     </example>
     Vous ne devez pas fermer la connexion au serveur PostgreSQL avant
     de fermer l'objet de grande taille.
    </para>
   </section>
  </partintro>

&reference.pgsql.functions;

 </reference>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->

