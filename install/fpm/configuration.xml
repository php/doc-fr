<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<!-- EN-Revision: 3d1de5938ef6812f13dbe7d067190e898f5351a9 Maintainer: jpauli Status: ready -->
<!-- Reviewed: no -->

<sect1 xml:id="install.fpm.configuration" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <title>Configuration</title>
 <para>
  FPM utilise la syntaxe &php.ini; pour son fichier de configuration - <filename>php-fpm.conf</filename>.
 </para>
 <sect2> 
  <title>Liste des directives globales de <filename>php-fpm.conf</filename></title>
  <variablelist>
   <varlistentry xml:id="pid">
    <term>
     <parameter>pid</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Chemin vers le fichier PID. Par défaut: none.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="error-log">
    <term>
     <parameter>error_log</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Chemin vers le fichier de journal. Par défaut:
      <literal>#INSTALL_PREFIX#/log/php-fpm.log</literal>.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="log-level">
    <term>
     <parameter>log_level</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Niveau de journalisation d'erreur. Valeurs possibles: alert, error, warning, notice,
      debug. Par défaut: notice.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="emergency-restart-threshold">
    <term>
     <parameter>emergency_restart_threshold</parameter>
     <type>int</type>
    </term>
    <listitem>
     <para>
      Si ce nombre de processus fils terminent avec un SIGSEGV ou SIGBUS dans l'intervalle
      de temps précisé dans <literal>emergency_restart_interval</literal>, alors FPM redémarrera.
      Une valeur de 0 signifie 'Off'. Valeur par défaut: 0 (Off).
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="emergency-restart-interval">
    <term>
     <parameter>emergency_restart_interval</parameter>
     <type>mixed</type>
    </term>
    <listitem>
     <para>
      Interval de temps utilisé par emergency_restart_interval pour determine lorsqu'un
      redémarrage doux doit être lancé. Ceci peut être utile pour contourner des corruptions
      accidentelles dans la méémoire partagée d'un acccelérateur. Unités disponibles:
      s(econdes), m(inutes), h(eures), ou d(ays).
      Unité par défaut: secondes. Valeur par défaut: 0 (Off).
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="process-control-timeout">
    <term>
     <parameter>process_control_timeout</parameter>
     <type>mixed</type>
    </term>
    <listitem>
     <para>
      Temps limite qu'attendront les processus fils pour réagir aux signals du père.
      Unités disponibles: s(econdes), m(inutes), h(eures), ou d(ays)
      Unité par défaut: secondes. Valeur par défaut: 0.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="daemonize">
    <term>
     <parameter>daemonize</parameter>
     <type>boolean</type>
    </term>
    <listitem>
     <para>
      Envoie FPM en arrière plan. Mettez 'no' pour garder FPM au premier plan lors du
      débogage. Valeur par défaut: yes.
     </para> 
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>
 
 <sect2> 
  <title>Liste des directives de pool</title>
  <para>
   Avec FPM vous pouvez executer plusieurs pools de processus avec des paramètres différents.
   Voici les paramètres qui peuvent être ajustés par pool. 
  </para>
  <variablelist>
   <varlistentry xml:id="listen">
    <term>
     <parameter>listen</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      L'adresse pour accepter des requêtes FastCGI. Syntaxes valides:
      'ip.add.re.ss:port', 'port', '/path/to/unix/socket'. Cette option est obligatoire
      pour chaque pool.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="listen-backlog">
    <term>
     <parameter>listen.backlog</parameter>
     <type>int</type>
    </term>
    <listitem>
     <para>
      Affecte listen(2) backlog. Une valeur de '-1' signifie illimité. Valeur par défaut:
      -1.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="listen-allowed-clients">
    <term>
     <parameter>listen.allowed_clients</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Liste d'adresses ipv4 des clients FastCGI autorisés à se connecter. C'est équivalent
      à la variable d'environnement FCGI_WEB_SERVER_ADDRS dans le système FastCGI original de
      PHP (5.2.2+). N'a de sens qu'avec un socket tcp en écoute. Chaque adresse doit être séparée
      par une virgule. Si cette valeur n'est pas précisée, les connexions seront accceptées depuis
      toute adresse ip. Valeur par défaut: any.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="listen-owner">
    <term>
     <parameter>listen.owner</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Affecte les permissions pour le socket Unix si utilisé. Sous Linux, les permissions read/write
      doivent être affectées pour autoriser des connexions depuis un serveur web. Beaucoup de systèmes
      dérivés BSD autorisent les connexions quelles que soient les permissions.
      Valeurs par défaut: user et group sont ceux de l'utilisateur courant, le mode est 0666.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="listen-group">
    <term>
     <parameter>listen.group</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Voyez <literal>listen.owner</literal>.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="listen-mode">
    <term>
     <parameter>listen.mode</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Voyez <literal>listen.owner</literal>.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="user">
    <term>
     <parameter>user</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Utilisateur Unix des processus FPM. Cette option est obligatoire.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="group">
    <term>
     <parameter>group</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Groupe Unix des processus FPM. Si non précisé, le groupe de l'utilisateur est
      utilisé. 
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="pm">
    <term>
     <parameter>pm</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Choisi comment le gestionnaire de processus va contrôler le nombre de processus fils.
      Valeurs possibles : <literal>static</literal>, <literal>ondemand</literal>,
      <literal>dynamic</literal>. Option obligatoire.
     </para>
     <para>
      <literal>static</literal> - nombre de processus fils fixés (<literal>pm.max_children</literal>).
     </para>
     <para>
      <literal>ondemand</literal> - le processus se réactive à la demande
      (lorsque demandé, c'est l'opposé de dynamique où <literal>pm.start_servers</literal>
      sont démarrés lorsque le service démarre).
     </para>
     <para>
      <literal>dynamic</literal> - nombre de processus fils dynamiques basé sur le directives suivantes:
      <literal>pm.max_children</literal>, <literal>pm.start_servers</literal>, 
      <literal>pm.min_spare_servers</literal>, <literal>pm.max_spare_servers</literal>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="pm.max-chidlren">
    <term>
     <parameter>pm.max_children</parameter>
     <type>int</type>
    </term>
    <listitem>
     <para>
      Nombre de processus fils à créer lorsque <literal>pm</literal> est réglé sur
      <literal>static</literal>. Nombre maximum de processus fils à créer lorsque
      <literal>pm</literal> est réglé sur <literal>dynamic</literal>. Options obligatoire.
     </para>
     <para>
      Cette option affecte la limite du nombre de requêtes simultanées qui seront servies. Equivalent à
      ApacheMaxClients avec mpm_prefork et à <varname>PHP_FCGI_CHILDREN</varname> dans l'implémentation originale
      de FastCGI de PHP.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="pm.start-servers">
    <term>
     <parameter>pm.start_servers</parameter>
     <type>in</type>
    </term>
    <listitem>
     <para>
      Nombre de processus fils à créer au démarrage. Utilisé seulement si
      <literal>pm</literal> est réglé sur <literal>dynamic</literal>.
      Valeur par défaut: min_spare_servers + (max_spare_servers -
      min_spare_servers) / 2.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="pm.min-spare-servers">
    <term>
     <parameter>pm.min_spare_servers</parameter>
     <type>int</type>
    </term>
    <listitem>
     <para>
      Nombre minimum de processus au repos (idle) voulus. Utilisé seulement si
      <literal>pm</literal> est réglé sur <literal>dynamic</literal>. Obligatoire dans
      ce cas.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="pm.max-spare-servers">
    <term>
     <parameter>pm.max_spare_servers</parameter>
     <type>int</type>
    </term>
    <listitem>
     <para>
      Nombre maximum de processus au repos (idle) voulus. Utilisé seulement si
      <literal>pm</literal> est réglé sur <literal>dynamic</literal>. Obligatoire dans
      ce cas.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="pm.max-requests">
    <term>
     <parameter>pm.max_requests</parameter>
     <type>int</type>
    </term>
    <listitem>
     <para>
      Nombre de requête que chaque processus fils devrait exécuter avant de renaitre.
      Ceci peut être utile pour contourner des fuites mémoires dans des librairies tierces.
      Pour un traitement sans fin des requêtes, précisez '0'. Equivalent à
      <varname>PHP_FCGI_MAX_REQUESTS</varname>. Par défaut: 0.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="pm.status-path">
    <term>
     <parameter>pm.status_path</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      L'URI vers la page de statut de FPM. Si cette valeur n'est pas précisée, aucune page de statut
      ne sera utilisée, ce qui est le cas par défaut.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="ping.path">
    <term>
     <parameter>ping.path</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      L'URI de ping pour appeler la page de monitoring de FPM. Si aucune valeur n'est précisée,
      aucune page de ping ne sera disponible. Ceci pourrait être utilisé pour tester depuis l'extérieur
      si FPM est toujours disponible et prêt à répondre. Notez que la valeur doit commencer par un
      slash (/).
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="ping.response">
    <term>
     <parameter>ping.response</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Cette directive est utile pour personnaliser la réponse à une requête de ping.
      La réponse est formatée comme text/plain avec un code de réponse de 200.
      Valeur par défaut: pong.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="request-terminate-timeout">
    <term>
     <parameter>request_terminate_timeout</parameter>
     <type>mixed</type>
    </term>
    <listitem>
     <para>
      Le timeout pour servir une requête après lequel le processus concerné sera tué.
      Cette option devrait être utilisée lorsque l'option 'max_execution_time' ne stoppe
      pas l'exécution du script pour une raison quelconque. Une valeur de '0' signifie
      'Off'. Unités disponibles: s(econdes)(défaut), m(inutes), h(eures), ou d(ays).
      Par défaut: 0.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="request-slowlog-timeout">
    <term>
     <parameter>request_slowlog_timeout</parameter>
     <type>mixed</type>
    </term>
    <listitem>
     <para>
      Le timeout pour servir une requête dans laquelle la backtrace PHP sera vidée dans le
      fichier 'slowlog'. Une valeur de '0' signifie 'Off'.
      Unités disponibles: s(econdes)(défaut), m(inutes), h(eures), ou d(ays).
      Par défaut: 0.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="slowlog">
    <term>
     <parameter>slowlog</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Le journal pour les requêtes lentes, par défaut:
      <literal>#INSTALL_PREFIX#/log/php-fpm.log.slow</literal>.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="rlimit-files">
    <term>
     <parameter>rlimit_files</parameter>
     <type>int</type>
    </term>
    <listitem>
     <para>
      Affecte la rlimit pour les descripteurs de fichiers ouverts. Valeur par défaut: valeur du système.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="rlimit-core">
    <term>
     <parameter>rlimit_core</parameter>
     <type>int</type>
    </term>
    <listitem>
     <para>
      Affecte la taille maximale de rlimit. Valeurs possibles: 'unlimited' ou un entier
      plus grand ou égal à 0. Valeur par défaut: valeur définie par le système.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="chroot">
    <term>
     <parameter>chroot</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Chroot vers ce dossier au démarrage. Cette valeur doit être un chemin absolu.
      Si cette valeur n'est pas définie, chroot n'est pas utilisé.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="chdir">
    <term>
     <parameter>chdir</parameter>
     <type>string</type>
    </term>
    <listitem>
     <para>
      Chdir vers ce dossier au démarrage. Cette valeur doit être un chemin absolu.
      Valeur par défaut: dossier courant ou / si chroot.
     </para> 
    </listitem>
   </varlistentry>
   <varlistentry xml:id="catch-workers-output">
    <term>
     <parameter>catch_workers_output</parameter>
     <type>boolean</type>
    </term>
    <listitem>
     <para>
      Redirige stdout et stderr vers le journal d'erreur principal. Si non précisé,
      stdout et stderr seront redirigés vers /dev/null selon les specifications FastCGI.
      Valeur par défaut: no.
     </para> 
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   Il est possible de passer des variables d'environnement additionnelles et mettre à jour les paramètres
   de PHP d'un pool. Pour ce faire, vous devez ajouter les options suivantes à
   <filename>php-fpm.conf</filename>
   <example>
    <title>Passer des variables d'environnement et des paramètres PHP à un pool</title>
    <programlisting role="ini">
<![CDATA[
       env[HOSTNAME] = $HOSTNAME
       env[PATH] = /usr/local/bin:/usr/bin:/bin
       env[TMP] = /tmp
       env[TMPDIR] = /tmp
       env[TEMP] = /tmp

       php_admin_value[sendmail_path] = /usr/sbin/sendmail -t -i -f www@my.domain.com
       php_flag[display_errors] = off
       php_admin_value[error_log] = /var/log/fpm-php.www.log
       php_admin_flag[log_errors] = on
       php_admin_value[memory_limit] = 32M
       ]]>
    </programlisting>
   </example>
   Les paramètres PHP passés avec <literal>php_value</literal> ou
   <literal>php_flag</literal> écraseront leur valeur précédente.
   Notez que définir
   <link linkend="ini.disable-functions">disable_functions</link> ou 
   <link linkend="ini.disable-classes">disable_classes</link> n'écrasera pas
   les valeurs concernées précédemment définies dans <filename>php.ini</filename>,
   mais rajouteront les valeurs à la suite des anciennes.
  </para>
  <para>
   Les paramètres définis avec <literal>php_admin_value</literal> et <literal>php_admin_flag</literal>
   ne peuvent être surchargés via <function>ini_set</function>.
  </para>
 </sect2>
 
</sect1>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
